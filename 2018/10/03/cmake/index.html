<!DOCTYPE html><html><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="science &amp; art"><title>cmake | Hexo</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-time">2018-10-03</div></div></div><div class="container post-header"><h1>cmake</h1></div><div class="container post-content"><p><code>CMake</code> is an open-source, cross-platform family of tools designed to build, test and package software.</p>
<hr>
<p>第一个例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cmake_minimum_required (VERSION 3.12.2)</span><br><span class="line"></span><br><span class="line">project (Demo1)</span><br><span class="line">add_executable(Demo main.cc)</span><br></pre></td></tr></table></figure>
<p><code>cmake_minimum_required</code> CMake 最低版本号要求。</p>
<p><code>project</code> 指定项目信息。</p>
<p><code>add_executable</code> 指定生成目标，将名为 main.cc 的源文件编译成名称为 Demo 的可执行文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">-- The C compiler identification is AppleClang 9.1.0.9020039</span><br><span class="line">-- The CXX compiler identification is AppleClang 9.1.0.9020039</span><br><span class="line">-- Check for working C compiler: /Library/Developer/CommandLineTools/usr/bin/cc</span><br><span class="line">-- Check for working C compiler: /Library/Developer/CommandLineTools/usr/bin/cc -- works</span><br><span class="line">-- Detecting C compiler ABI info</span><br><span class="line">-- Detecting C compiler ABI info - done</span><br><span class="line">-- Detecting C compile features</span><br><span class="line">-- Detecting C compile features - done</span><br><span class="line">-- Check for working CXX compiler: /Library/Developer/CommandLineTools/usr/bin/c++</span><br><span class="line">-- Check for working CXX compiler: /Library/Developer/CommandLineTools/usr/bin/c++ -- works</span><br><span class="line">-- Detecting CXX compiler ABI info</span><br><span class="line">-- Detecting CXX compiler ABI info - done</span><br><span class="line">-- Detecting CXX compile features</span><br><span class="line">-- Detecting CXX compile features - done</span><br><span class="line">-- Configuring done</span><br><span class="line">-- Generating done</span><br><span class="line">-- Build files have been written to: /Users/darion.yaphet/source/cmake-demo/Demo1</span><br></pre></td></tr></table></figure>
<p>当前目录执行 <code>cmake .</code> ，得到 <code>Makefile</code> 后再使用 <code>make</code> 命令编译得到 Demo1 可执行文件。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Scanning dependencies of target Demo</span><br><span class="line">[ 50%] Building CXX object CMakeFiles/Demo.dir/main.cc.o</span><br><span class="line">[100%] Linking CXX executable Demo</span><br><span class="line">[100%] Built target Demo</span><br></pre></td></tr></table></figure>
<p><code>aux_source_directory</code> 会查找指定目录下的所有源文件，然后将结果存进指定变量名。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aux_source_directory(&lt;dir&gt; &lt;variable&gt;)</span><br></pre></td></tr></table></figure>
<hr>
<p>The <code>ctest</code> is the CMake test driver program. CMake-generated build trees created for projects that use the ENABLE_TESTING and ADD_TEST commands have testing support. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br></pre></td><td class="code"><pre><span class="line">ctest --help                                                                                                                                      darion.yaphet@192</span><br><span class="line">Usage</span><br><span class="line"></span><br><span class="line">  ctest [options]</span><br><span class="line"></span><br><span class="line">Options</span><br><span class="line">  -C &lt;cfg&gt;, --build-config &lt;cfg&gt;</span><br><span class="line">                               = Choose configuration to test.</span><br><span class="line">  -V,--verbose                 = Enable verbose output from tests.</span><br><span class="line">  -VV,--extra-verbose          = Enable more verbose output from tests.</span><br><span class="line">  --debug                      = Displaying more verbose internals of CTest.</span><br><span class="line">  --output-on-failure          = Output anything outputted by the test</span><br><span class="line">                                 program if the test should fail.</span><br><span class="line">  --test-output-size-passed &lt;size&gt;</span><br><span class="line">                               = Limit the output for passed tests to &lt;size&gt;</span><br><span class="line">                                 bytes</span><br><span class="line">  --test-output-size-failed &lt;size&gt;</span><br><span class="line">                               = Limit the output for failed tests to &lt;size&gt;</span><br><span class="line">                                 bytes</span><br><span class="line">  -F                           = Enable failover.</span><br><span class="line">  -j &lt;jobs&gt;, --parallel &lt;jobs&gt; = Run the tests in parallel using the given</span><br><span class="line">                                 number of jobs.</span><br><span class="line">  -Q,--quiet                   = Make ctest quiet.</span><br><span class="line">  -O &lt;file&gt;, --output-log &lt;file&gt;</span><br><span class="line">                               = Output to log file</span><br><span class="line">  -N,--show-only               = Disable actual execution of tests.</span><br><span class="line">  -L &lt;regex&gt;, --label-regex &lt;regex&gt;</span><br><span class="line">                               = Run tests with labels matching regular</span><br><span class="line">                                 expression.</span><br><span class="line">  -R &lt;regex&gt;, --tests-regex &lt;regex&gt;</span><br><span class="line">                               = Run tests matching regular expression.</span><br><span class="line">  -E &lt;regex&gt;, --exclude-regex &lt;regex&gt;</span><br><span class="line">                               = Exclude tests matching regular expression.</span><br><span class="line">  -LE &lt;regex&gt;, --label-exclude &lt;regex&gt;</span><br><span class="line">                               = Exclude tests with labels matching regular</span><br><span class="line">                                 expression.</span><br><span class="line">  -FA &lt;regex&gt;, --fixture-exclude-any &lt;regex&gt;</span><br><span class="line">                               = Do not automatically add any tests for</span><br><span class="line">                                 fixtures matching regular expression.</span><br><span class="line">  -FS &lt;regex&gt;, --fixture-exclude-setup &lt;regex&gt;</span><br><span class="line">                               = Do not automatically add setup tests for</span><br><span class="line">                                 fixtures matching regular expression.</span><br><span class="line">  -FC &lt;regex&gt;, --fixture-exclude-cleanup &lt;regex&gt;</span><br><span class="line">                               = Do not automatically add cleanup tests for</span><br><span class="line">                                 fixtures matching regular expression.</span><br><span class="line">  -D &lt;dashboard&gt;, --dashboard &lt;dashboard&gt;</span><br><span class="line">                               = Execute dashboard test</span><br><span class="line">  -D &lt;var&gt;:&lt;type&gt;=&lt;value&gt;      = Define a variable for script mode</span><br><span class="line">  -M &lt;model&gt;, --test-model &lt;model&gt;</span><br><span class="line">                               = Sets the model for a dashboard</span><br><span class="line">  -T &lt;action&gt;, --test-action &lt;action&gt;</span><br><span class="line">                               = Sets the dashboard action to perform</span><br><span class="line">  --track &lt;track&gt;              = Specify the track to submit dashboard to</span><br><span class="line">  -S &lt;script&gt;, --script &lt;script&gt;</span><br><span class="line">                               = Execute a dashboard for a configuration</span><br><span class="line">  -SP &lt;script&gt;, --script-new-process &lt;script&gt;</span><br><span class="line">                               = Execute a dashboard for a configuration</span><br><span class="line">  -A &lt;file&gt;, --add-notes &lt;file&gt;= Add a notes file with submission</span><br><span class="line">  -I [Start,End,Stride,test#,test#|Test file], --tests-information</span><br><span class="line">                               = Run a specific number of tests by number.</span><br><span class="line">  -U, --union                  = Take the Union of -I and -R</span><br><span class="line">  --rerun-failed               = Run only the tests that failed previously</span><br><span class="line">  --repeat-until-fail &lt;n&gt;      = Require each test to run &lt;n&gt; times without</span><br><span class="line">                                 failing in order to pass</span><br><span class="line">  --max-width &lt;width&gt;          = Set the max width for a test name to output</span><br><span class="line">  --interactive-debug-mode [0|1]</span><br><span class="line">                               = Set the interactive mode to 0 or 1.</span><br><span class="line">  --no-label-summary           = Disable timing summary information for</span><br><span class="line">                                 labels.</span><br><span class="line">  --no-subproject-summary      = Disable timing summary information for</span><br><span class="line">                                 subprojects.</span><br><span class="line">  --build-and-test             = Configure, build and run a test.</span><br><span class="line">  --build-target               = Specify a specific target to build.</span><br><span class="line">  --build-nocmake              = Run the build without running cmake first.</span><br><span class="line">  --build-run-dir              = Specify directory to run programs from.</span><br><span class="line">  --build-two-config           = Run CMake twice</span><br><span class="line">  --build-exe-dir              = Specify the directory for the executable.</span><br><span class="line">  --build-generator            = Specify the generator to use.</span><br><span class="line">  --build-generator-platform   = Specify the generator-specific platform.</span><br><span class="line">  --build-generator-toolset    = Specify the generator-specific toolset.</span><br><span class="line">  --build-project              = Specify the name of the project to build.</span><br><span class="line">  --build-makeprogram          = Specify the make program to use.</span><br><span class="line">  --build-noclean              = Skip the make clean step.</span><br><span class="line">  --build-config-sample        = A sample executable to use to determine the</span><br><span class="line">                                 configuration</span><br><span class="line">  --build-options              = Add extra options to the build step.</span><br><span class="line">  --test-command               = The test to run with the --build-and-test</span><br><span class="line">                                 option.</span><br><span class="line">  --test-timeout               = The time limit in seconds, internal use</span><br><span class="line">                                 only.</span><br><span class="line">  --test-load                  = CPU load threshold for starting new parallel</span><br><span class="line">                                 tests.</span><br><span class="line">  --tomorrow-tag               = Nightly or experimental starts with next day</span><br><span class="line">                                 tag.</span><br><span class="line">  --overwrite                  = Overwrite CTest configuration option.</span><br><span class="line">  --extra-submit &lt;file&gt;[;&lt;file&gt;]</span><br><span class="line">                               = Submit extra files to the dashboard.</span><br><span class="line">  --force-new-ctest-process    = Run child CTest instances as new processes</span><br><span class="line">  --schedule-random            = Use a random order for scheduling tests</span><br><span class="line">  --submit-index               = Submit individual dashboard tests with</span><br><span class="line">                                 specific index</span><br><span class="line">  --timeout &lt;seconds&gt;          = Set a global timeout on all tests.</span><br><span class="line">  --stop-time &lt;time&gt;           = Set a time at which all tests should stop</span><br><span class="line">                                 running.</span><br><span class="line">  --http1.0                    = Submit using HTTP 1.0.</span><br><span class="line">  --no-compress-output         = Do not compress test output when submitting.</span><br><span class="line">  --print-labels               = Print all available test labels.</span><br><span class="line">  --help,-help,-usage,-h,-H,/? = Print usage information and exit.</span><br><span class="line">  --version,-version,/V [&lt;f&gt;]  = Print version number and exit.</span><br><span class="line">  --help-full [&lt;f&gt;]            = Print all help manuals and exit.</span><br><span class="line">  --help-manual &lt;man&gt; [&lt;f&gt;]    = Print one help manual and exit.</span><br><span class="line">  --help-manual-list [&lt;f&gt;]     = List help manuals available and exit.</span><br><span class="line">  --help-command &lt;cmd&gt; [&lt;f&gt;]   = Print help for one command and exit.</span><br><span class="line">  --help-command-list [&lt;f&gt;]    = List commands with help available and exit.</span><br><span class="line">  --help-commands [&lt;f&gt;]        = Print cmake-commands manual and exit.</span><br><span class="line">  --help-module &lt;mod&gt; [&lt;f&gt;]    = Print help for one module and exit.</span><br><span class="line">  --help-module-list [&lt;f&gt;]     = List modules with help available and exit.</span><br><span class="line">  --help-modules [&lt;f&gt;]         = Print cmake-modules manual and exit.</span><br><span class="line">  --help-policy &lt;cmp&gt; [&lt;f&gt;]    = Print help for one policy and exit.</span><br><span class="line">  --help-policy-list [&lt;f&gt;]     = List policies with help available and exit.</span><br><span class="line">  --help-policies [&lt;f&gt;]        = Print cmake-policies manual and exit.</span><br><span class="line">  --help-property &lt;prop&gt; [&lt;f&gt;] = Print help for one property and exit.</span><br><span class="line">  --help-property-list [&lt;f&gt;]   = List properties with help available and</span><br><span class="line">                                 exit.</span><br><span class="line">  --help-properties [&lt;f&gt;]      = Print cmake-properties manual and exit.</span><br><span class="line">  --help-variable var [&lt;f&gt;]    = Print help for one variable and exit.</span><br><span class="line">  --help-variable-list [&lt;f&gt;]   = List variables with help available and exit.</span><br><span class="line">  --help-variables [&lt;f&gt;]       = Print cmake-variables manual and exit.</span><br></pre></td></tr></table></figure>
<p>Reference:</p>
<ol>
<li><a href="http://www.hahack.com/codes/cmake/" target="_blank" rel="noopener">CMake 入门实战</a></li>
<li><a href="https://cmake.org/cmake-tutorial/" target="_blank" rel="noopener">cmake-tutorial</a></li>
<li><a href="https://www.cnblogs.com/dverdon/p/4574221.html" target="_blank" rel="noopener">CMake构建系统的骨架</a></li>
</ol>
</div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>