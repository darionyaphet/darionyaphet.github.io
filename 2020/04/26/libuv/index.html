<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="science &amp; art"><title>libuv | Hexo</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/font.css"><link rel="stylesheet" type="text/css" href="/css/noise.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><article class="wrapper"><div class="post-main"><div class="nav"><nav class="container"><a class="sidebar-nav-item active" href="/">Home</a><a class="sidebar-nav-item" href="/archives">Archives</a></nav><div class="container post-meta"><div class="post-time">2020-04-26</div></div></div><div class="container post-header"><h1>libuv</h1></div><div class="container post-content"><p><code>libuv</code> 是一个跨平台支持库，围绕着事件驱动的异步I/O模型而设计。</p>
<p><code>libuv</code> 提供不仅仅是对不同<code>I/O轮询机制</code>的简单抽象，还包括： <code>句柄</code>和<code>流</code>对套接字和其他实体提供了高级别的抽象； 也提供了跨平台的文件I/O和线程功能。</p>
<p><code>libuv</code> 提供给用户使用两个抽象，与事件循环相配合： <code>句柄</code> 和 <code>请求</code>。<code>句柄</code> 表示能够在活动时执行特定操作的长期存在的对象。<code>请求</code> 代表着短期的操作。这些操作可以通过一个句柄执行： 写请求用于在句柄上写数据；或是独立不需要句柄的：getaddrinfo 请求 不需要句柄，它们直接在循环上运行。</p>
<p><code>I/O循环</code>是 <code>libuv</code> 的核心组件。 它为全部I/O操作建立内容， 并且它必须关联到单个线程。 可以运行多个事件循环 只要每个运行在不同的线程。 libuv 事件循环 <em>不是线程安全的</em> 除非另行说明。</p>
<ol>
<li>循环概念 <code>now</code> 被更新。 在开始事件循环计的时候事件循环缓存当前的时间以减少时间相关的系统调用的数目。</li>
<li>如果循环处于 <code>活动</code> 状态的话一次迭代开始，否则的话循环立刻终止。 那么， 何时一个循环确定是 活动 的？如果一个循环有活动的和被引用的句柄、 活动的请求或正在关闭的句柄，它被确定为 <code>活动</code> 的。</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">while there are still events to process:</span><br><span class="line">     e = get the next event</span><br><span class="line">     if there is a callback associated with e:</span><br><span class="line">         call the callback</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;stdlib.h&gt;</span><br><span class="line">#include &lt;uv.h&gt;</span><br><span class="line"></span><br><span class="line">int main() &#123;</span><br><span class="line">    uv_loop_t *loop = static_cast&lt;uv_loop_t *&gt;(malloc(sizeof(uv_loop_t)));</span><br><span class="line">    uv_loop_init(loop);</span><br><span class="line">    printf(&quot;Now quitting.\n&quot;);</span><br><span class="line">    uv_run(loop, UV_RUN_DEFAULT);</span><br><span class="line">    uv_loop_close(loop);</span><br><span class="line">    free(loop);</span><br><span class="line">    return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div></div><div class="post-main post-comment"></div></article><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
  $(".fancybox").fancybox();
});
</script></body></html>